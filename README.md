# 자유의지 예측 - 집필 시스템

## 설치 방법

1. Node.js가 설치되어 있어야 합니다. (https://nodejs.org)

2. 터미널(명령 프롬프트)을 열고 다음 명령어를 실행하세요:

```bash
cd D:/work/book2
npm install
```

3. **(선택) AI 가이드 기능을 사용하려면** Anthropic API 키가 필요합니다:
   - https://console.anthropic.com/settings/keys 에서 API 키 발급
   - `.env.example` 파일을 복사하여 `.env` 파일 생성
   - `.env` 파일에 발급받은 API 키 입력:
     ```
     ANTHROPIC_API_KEY=sk-ant-api03-...
     ```
   - **주의**: API 키 없이도 편집 기능은 정상적으로 사용할 수 있습니다. AI 가이드만 사용할 수 없습니다.

## 실행 방법

터미널에서 다음 명령어를 실행하세요:

```bash
npm start
```

또는

```bash
node server.js
```

서버가 시작되면 브라우저에서 다음 주소를 여세요:

```
http://localhost:3000/index.html
```

## ✨ 주요 기능

### 📝 기본 편집 기능
- WYSIWYG 편집기 (What You See Is What You Get)
- 실시간 미리보기
- 제목, 굵게, 기울임, 구분선, 표 삽입
- HTML 태그 직접 사용 가능

### 🖼️ 이미지 관리
- 버튼 클릭 또는 드래그 앤 드롭으로 이미지 삽입
- 편집 중에도 이미지 실시간 미리보기
- 자동 크기 조정 (가로 80%) 및 중앙 정렬
- 이미지 앞뒤 자동 여백 추가

### 🤖 AI 글쓰기 가이드
- 챕터별 맞춤 가이드 자동 생성
- 작성 내용 기반 재가이드 생성
- 배경, 핵심 개념, 구체적 설명, 연결점, 독자 공감 포인트 제시
- 실시간 개선 방향 제안

### 📎 파일 관리
- 첨부파일 업로드 및 관리
- 챕터별 독립적인 파일 저장
- 자동 백업 시스템

## 사용 방법

### 1. 챕터 선택
- 왼쪽 사이드바에서 원하는 챕터를 클릭하세요
- 내용이 있는 챕터는 녹색으로 표시됩니다

### 2. 내용 작성
- 내용이 없는 챕터를 클릭하면 자동으로 편집기가 나타납니다
- 내용이 있는 챕터는 "수정" 버튼을 클릭하여 편집할 수 있습니다

### 3. 서식 기능
- **제목 1, 2, 3**: 제목 스타일 적용
- **구분선**: 수평선 삽입
- **표 삽입**: 기본 표 템플릿 삽입
- **굵게/기울임**: 텍스트 강조
- **🖼️ 이미지**: 이미지 삽입 (NEW!)

### 4. 이미지 삽입 방법
- **방법 1**: 툴바의 "🖼️ 이미지" 버튼 클릭 → 이미지 파일 선택
- **방법 2**: 이미지 파일을 편집기에 **드래그 앤 드롭**
- 이미지는 현재 커서 위치에 자동으로 삽입됩니다
- **이미지 크기**: 가로 80% 자동 설정
- **여백**: 이미지 앞뒤로 2줄씩 자동 공백 추가
- 업로드된 이미지는 `uploads` 폴더에 저장됩니다
- **편집 모드에서도 이미지 미리보기** - 실시간으로 이미지를 확인하면서 작성 가능
- 뷰 모드에서 이미지가 아름답게 표시됩니다

### 5. 첨부파일
- 파일 업로드 영역을 클릭하여 파일 선택
- 업로드된 파일은 챕터와 함께 저장됩니다

### 6. 저장
- "저장" 버튼을 클릭하여 내용 저장
- 자동으로 뷰 모드로 전환됩니다

### 7. 글쓰기 가이드 (AI 기능) ✨ NEW!

#### 자동 가이드 생성
- **챕터 선택 시**: 해당 챕터에 맞는 글쓰기 가이드 자동 생성
- **전체 목차 분석**: 도서의 전체 구조를 파악하여 맥락에 맞는 가이드 제공
- **가이드 내용** (내용이 없을 때):
  - 📌 이 챕터의 목적과 배경
  - 💡 다루어야 할 핵심 개념
  - 📝 구체적인 작성 방향
  - 🔗 전후 챕터와의 연결
  - ❤️ 독자 공감 전략
  - ✍️ 추천 작성 분량

#### 재가이드 생성 🔄
- **버튼**: "🔄 재가이드 생성" 버튼을 클릭
- **작동 방식**:
  - **내용이 있을 때**: 작성된 내용을 분석하여 개선 방향 제시
    - ✅ 현재 내용의 강점
    - 📝 보충이 필요한 내용
    - 🔧 수정이 필요한 부분
    - 🔗 전후 맥락 연결
    - 💡 독자 공감 포인트
  - **내용이 없을 때**: 목차와 제목만으로 작성 가이드 제공
    - 전체 목차 구조를 참고한 체계적인 가이드
    - 해당 챕터가 담당해야 할 역할 명확히 제시
- **특징**: 
  - 내용의 분량에 관계없이 항상 사용 가능
  - 전체 목차 맥락을 고려한 통합적 가이드
  - 이전/다음 챕터와의 자연스러운 연결 제안

## 📐 화면 구성

```
┌─────────────┬──────────────────────┬──────────────┐
│   목차      │    편집 영역         │  글쓰기      │
│  (왼쪽)     │     (중앙)           │  가이드      │
│             │                      │  (오른쪽)    │
│  - 프롤로그 │  [편집기/뷰어]       │  ✍️ AI 가이드│
│  - 제1부    │                      │  🔄 재생성   │
│  - 제2부    │  [이미지 삽입]       │             │
│  ...        │  [표, 서식]          │  [제안 내용] │
└─────────────┴──────────────────────┴──────────────┘
```

## 파일 구조

```
D:/work/book2/
├── server.js          # Node.js 서버
├── index.html         # 메인 HTML 파일
├── package.json       # npm 패키지 설정
├── data.json          # 챕터 데이터 (자동 생성)
└── uploads/           # 업로드된 파일 (자동 생성)
```

## 주의사항

- 서버가 실행 중이어야 시스템을 사용할 수 있습니다
- 데이터는 `data.json` 파일에 저장됩니다
- 백업을 위해 주기적으로 `data.json` 파일을 복사해두세요

## 💡 사용 팁

1. **이미지 삽입**: 커서를 원하는 위치에 놓고 이미지 버튼을 클릭하거나 드래그 앤 드롭하세요
2. **여러 이미지 삽입**: 편집기에 여러 이미지를 한 번에 드롭하면 순차적으로 삽입됩니다
3. **표 만들기**: "표 삽입" 버튼을 누르면 기본 표 템플릿이 삽입되며, 행/열을 직접 수정할 수 있습니다
4. **HTML 태그 사용**: `<p>`, `<strong>`, `<em>` 등 HTML 태그를 직접 입력할 수 있습니다
5. **글쓰기 가이드 활용 전략**: 
   - **작성 전**: 챕터를 선택하면 자동으로 전체 목차를 고려한 가이드가 생성됩니다
   - **작성 중**: 가이드를 참고하여 체계적으로 내용을 작성합니다
   - **작성 후**: "재가이드 생성"을 클릭하여 작성한 내용을 분석받고 개선점을 확인합니다
   - **반복**: 개선 후 다시 재가이드를 생성하여 완성도를 높입니다
   - **주의**: 내용이 없어도 재가이드를 누를 수 있으며, 이 경우 목차 기반 가이드를 다시 받습니다
6. **데이터 백업**: `data.json`과 `uploads` 폴더를 주기적으로 복사해서 백업하세요

## 문제 해결

### 포트 3000이 이미 사용 중인 경우
`server.js` 파일에서 `PORT` 값을 다른 번호로 변경하세요 (예: 3001, 3002 등)

### npm install 오류
관리자 권한으로 명령 프롬프트를 실행한 후 다시 시도하세요

### AI 가이드 생성 오류
- **"가이드 생성에 실패했습니다"**: API 키가 설정되지 않았거나 잘못되었습니다
- **해결 방법**: 
  1. `.env.example` 파일을 복사하여 `.env` 파일 생성
  2. Anthropic API 키 발급 (https://console.anthropic.com/settings/keys)
  3. `.env` 파일에 API 키 입력
  4. 서버 재시작
- **자세한 설명**: `API_KEY_SETUP.md` 파일 참고
- **참고**: API 키 없이도 모든 편집 기능은 정상 작동합니다

### 이미지가 표시되지 않는 경우
- `uploads` 폴더가 자동으로 생성되었는지 확인
- 서버가 정상적으로 실행 중인지 확인

