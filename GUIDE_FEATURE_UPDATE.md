# 글쓰기 가이드 기능 개선 사항

## 업데이트 내용

### 1. 가이드 히스토리 기능 ⭐ NEW!
- **여러 버전의 가이드 저장**: 새가이드를 생성할 때마다 이전 가이드가 히스토리에 보관됨
- **버전 탐색**: 이전/다음 버튼으로 과거 가이드를 쉽게 탐색
- **버전 표시**: 현재 보고 있는 가이드가 몇 번째 버전인지 표시
- **최신/이전 뱃지**: 최신 가이드와 이전 가이드를 명확히 구분

### 2. 가이드 토글 기능 (숨기기/보이기)
- 가이드 패널 상단에 "숨기기" 버튼 추가
- 가이드 내용을 숨기거나 표시할 수 있음
- 상태에 따라 버튼 텍스트가 자동으로 변경됨

### 3. 가이드 영구 저장
- 한번 생성된 가이드는 데이터베이스에 저장됨
- 페이지 새로고침 후에도 가이드가 유지됨
- 챕터 선택 시 저장된 가이드를 자동으로 불러옴
- "새가이드" 버튼을 눌러야만 새로운 가이드 생성

### 4. 모바일 UI 개선
- 모바일에서 중복 표시되던 가이드 제거
- 우측 슬라이드 패널에서만 가이드 표시
- 토글 버튼과 재가이드 버튼 모두 모바일에서 작동
- 가이드 히스토리 네비게이션 모바일 지원

### 5. 진행 상태 표시
- 가이드 생성 중 상태 표시 추가
- 헤더에 "생성 중..." 텍스트 표시
- 생성 완료 후 자동으로 숨김

## 데이터베이스 마이그레이션 필요

새로운 기능을 사용하려면 Supabase 데이터베이스에 `guide` 컬럼을 추가해야 합니다.

### 마이그레이션 방법

1. Supabase 대시보드에 로그인
2. SQL Editor로 이동
3. `supabase_guide_migration.sql` 파일의 내용을 실행

```sql
ALTER TABLE chapters
ADD COLUMN IF NOT EXISTS guide TEXT;

CREATE INDEX IF NOT EXISTS idx_chapters_guide ON chapters(guide) WHERE guide IS NOT NULL;

COMMENT ON COLUMN chapters.guide IS 'AI-generated writing guide for the chapter';
```

## 주요 변경 파일

### 1. index.html
- `generateGuide()`: 가이드 생성 함수 개선
  - 강제 재생성 플래그 추가
  - 저장된 가이드 로드 기능
  - 진행 상태 표시 추가
- `saveGuideToServer()`: 가이드 저장 함수 추가
- `toggleGuideContent()`: 가이드 토글 함수 추가
- UI에 토글 버튼과 진행 표시기 추가

### 2. server.js
- GET `/api/chapters`: 응답에 `guide` 필드 포함
- GET `/api/chapters/:id`: 응답에 `guide` 필드 포함
- POST `/api/chapters/:id`: 요청에서 `guide` 필드 처리하여 저장

### 3. mobile-ui.js
- `copyGuideContent()`: 가이드 복제 로직 개선
  - 전체 패널 대신 내용만 복제
  - 버튼 이벤트 연결
- `refreshGuideContent()`: 가이드 업데이트 함수 추가

### 4. supabase_guide_migration.sql (신규)
- 데이터베이스 마이그레이션 스크립트

## 사용 방법

### 가이드 생성
1. 챕터 선택
2. 자동으로 가이드 생성 (처음 선택 시)
3. 이후 선택 시 저장된 가이드 표시

### 가이드 재생성
1. "🔄 재가이드" 버튼 클릭
2. 새로운 가이드 생성
3. 자동으로 저장

### 가이드 숨기기/보이기
1. "숨기기" 버튼 클릭하여 가이드 숨김
2. "보이기" 버튼 클릭하여 가이드 표시

## 모바일 환경
- 우측 상단 📝 버튼으로 가이드 패널 열기
- 슬라이드 패널에서 가이드 확인
- 토글 및 재가이드 버튼 사용 가능
- 하단 중복 표시 제거됨

## 주의사항

1. **데이터베이스 마이그레이션 필수**: 마이그레이션을 실행하지 않으면 가이드 저장 기능이 작동하지 않습니다.
2. **API 키 필요**: 가이드 생성을 위해 ANTHROPIC_API_KEY가 설정되어 있어야 합니다.
3. **기존 가이드**: 마이그레이션 전에 생성된 가이드는 저장되지 않았으므로 재생성이 필요합니다.

## 향후 개선 사항

- [ ] 가이드 히스토리 관리 (여러 버전 저장)
- [ ] 가이드 편집 기능
- [ ] 가이드 템플릿 선택 기능
- [ ] 가이드 내보내기 (PDF, TXT)
